{% extends "admin_base.html" %}
{% block admin_content %}
<h3>{{ title }}</h3>
<form method="POST" enctype="multipart/form-data" class="form-container" style="margin:0; box-shadow:none; padding:0;">
    {{ form.hidden_tag() }}

    <p>{{ form.title.label }}<br>{{ form.title() }}</p>
    <p>{{ form.release_year.label }}<br>{{ form.release_year() }}</p>
    <p>{{ form.band.label }}<br>{{ form.band(id="band_select", style="width:100%; padding:12px;") }}</p>
    <p>{{ form.compositions.label }} (Ctrl/Cmd для выбора нескольких)<br>{{ form.compositions(id="composition_select", size=10, style="width:100%;") }}</p>
    <p>{{ form.cover_image.label }}<br>{{ form.cover_image() }}</p>
    <p>{{ form.submit() }}</p>
</form>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const bandSelect = document.getElementById('band_select');
    const compositionSelect = document.getElementById('composition_select');

    function updateCompositions() {
        const bandId = bandSelect.value;
        if (!bandId) { compositionSelect.innerHTML = ''; return; }

        fetch(`/api/compositions_by_band/${bandId}`)
            .then(response => response.json())
            .then(data => {
                compositionSelect.innerHTML = '';
                data.forEach(c => {
                    const option = document.createElement('option');
                    option.value = c.id;
                    option.textContent = c.title;
                    compositionSelect.appendChild(option);
                });
            });
    }

    bandSelect.addEventListener('change', updateCompositions);

    if (bandSelect.value) updateCompositions();
});
</script>
{% endblock %}
