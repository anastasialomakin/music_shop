{% extends "base.html" %}
{% block content %}
<!-- фильтры -->
<h2>Каталог пластинок</h2>
<div class="catalog-container">
    <aside class="filters-sidebar">
        <h4>Фильтры</h4>
        <p>(в разработке)</p>
    </aside>
    <div class="catalog-main">
        <div class="search-sort-bar">товар
            <input type="search" placeholder="Поиск...">
            <select><option>Сортировка (в разработке)</option></select>
        </div>
        <div class="catalog-grid">
    {% for record in records %}
    <div class="record-card">
        <a href="{{ url_for('record_detail', id=record.id) }}">
            <img src="{{ url_for('uploaded_file', filename=record.cover_image_url) if record.cover_image_url else 'https://via.placeholder.com/200' }}" alt="Обложка">
            <h3>{{ record.title }}</h3>
            <p>{{ record.release.band.name }}</p>
            <p><strong>{{ record.price }}₽</strong></p>
            {% if record.stock_quantity > 0 %}
    <p style="color: green;">В наличии</p>
    {% if current_user.is_authenticated and current_user.role == 'user' %}
        {% if record.id|string in session.get('cart', {}) %}
        <div class="cart-controls">
            <form action="{{ url_for('decrease_cart_item', record_id=record.id) }}" method="post" style="display: inline;">
                <button type="submit">-</button>
            </form>
            <span>{{ session['cart'][record.id|string] }} шт.</span>
            <form action="{{ url_for('add_to_cart', record_id=record.id) }}" method="post" style="display: inline;">
                <button type="submit">+</button>
            </form>
        </div>
        {% else %}
            <form action="{{ url_for('add_to_cart', record_id=record.id) }}" method="post">
                <button type="submit">Добавить в корзину</button>
            </form>
        {% endif %}
    {% endif %}
{% else %}
    <p style="color: red;">Нет в наличии</p>
{% endif %}
        </a>
    </div>
    {% endfor %}
        </div>
        <!-- TODO: Пагинация -->
        <div class="pagination" style="margin-top: 20px; text-align: center;">
            <p>(Пагинация в разработке)</p>
        </div>
    </div>
</div>
{% endblock %}