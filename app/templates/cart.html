{% extends "profile_base.html" %}

{% block profile_content %}
    <h3>Корзина</h3>
    {% if not items_with_details %}
        <p>Ваша корзина пуста.</p>
    {% else %}
        <div class="cart-items-container">
            {% for item in items_with_details %}
                <div class="cart-item-row">
                    <div class="cart-item-title">{{ item.record.title }}</div>
                    <div class="cart-item-price">{{ item.record.price }}₽</div>
                    <div class="cart-item-controls">
                        <form action="{{ url_for('decrease_cart_item', record_id=item.record.id) }}" method="post">
                            <button type="submit">-</button>
                        </form>
                        <span>{{ item.quantity }}</span>
                        <form action="{{ url_for('add_to_cart', record_id=item.record.id) }}" method="post">
                            <button type="submit">+</button>
                        </form>
                    </div>
                    <div class="cart-item-subtotal">{{ "%.2f"|format(item.subtotal) }}₽</div>
                    <div class="cart-item-remove">
                        <form action="{{ url_for('remove_from_cart', record_id=item.record.id) }}" method="post">
                            <button type="submit" title="Удалить"><i class="bi bi-x-lg"></i></button>
                        </form>
                    </div>
                </div>
            {% endfor %}
        </div>

        <div class="cart-total">
            Итого: {{ "%.2f"|format(total) }}₽
        </div>
        
        <hr>

        <div class="cart-actions">
            <form action="{{ url_for('clear_cart') }}" method="post" onsubmit="return confirm('Вы уверены, что хотите полностью очистить корзину?');">
                <button type="submit" class="cart-action-btn btn-danger">Очистить корзину</button>
            </form>
            <a href="{{ url_for('checkout') }}" class="cart-action-btn btn-success">Перейти к оформлению</a>
        </div>
    {% endif %}
{% endblock %}